---
title: 工具开发方法论
date: 2019-09-03 19:40:16
tags: 方法论
---

[TOC]
# 目标
工具需要实现的功能
# 实现过程
## 原理
功能实现原理
## 算法

1. 封闭入口类Main
2. 实现Usage函数，打印提示信息

3. 实现Main函数

* for循环命令数量判断，不符合则跳出打印Usage
* switch语句，根据不同命令而调用不同的处理函数，如果是未知命令，则跳出打印Usage

* 判断是否得到正确命令参数，如果没有或者showUsage字段为true则打印Usage

4. 命令处理函数

* while循环
  * 具体实现算法，一旦出错，设置错误码，跳出
* 判断返回码，执行相应操作

## 算法实践

1. 封闭入口类Main

```java
public class Main {

    .....
    /**
     * This class is uninstantiable.
     */
	private Main() {
        // This space intentionally left blank.
    }
}
```

2. 实现Usage函数，打印提示信息

```java
public class Main {
    private static String USAGE_MESSAGE =
        "usage:\n" +
        "......";
    
    /**
     * Prints the usage message.
     */
    private static void usage() {
        System.err.println(USAGE_MESSAGE);
    }
```

3. 实现Main函数

```java
	/**
     * Run!
     */
    public static void main(String[] args) {
    	boolean gotCmd = false;
        boolean showUsage = false;
        
    	try {
    		for (int i = 0; i < args.length; i++) {
                String arg = args[i];
                if (arg.equals("--") || !arg.startsWith("--")) {
                    gotCmd = false;
                    showUsage = true;
                    break;
                }
    		
	    		gotCmd = true;
	    		switch (arg) {
				case "--md5":
					command.scan.Main.md5Scan(without(args, i));
					break;
				case "--name":
					command.scan.Main.certNameScan(without(args, i));
					break;
				default:
					gotCmd = false;
					break;
				}
    		}
		} catch (Exception ex) {
			// TODO: handle exception
			showUsage = true;
		}
    	
    	if(!gotCmd) {
    		System.err.println("error: no command specified");
            showUsage = true;
    	}
    	
    	if(showUsage) {
    		Usage();
    	}
    }
    
    /**
     * Returns a copy of the given args array, but without the indicated
     * element.
     *
     * @param orig {@code non-null;} original array
     * @param n which element to omit
     * @return {@code non-null;} new array
     */
    private static String[] without(String[] orig, int n) {
        int len = orig.length - 1;
        String[] newa = new String[len];
        System.arraycopy(orig, 0, newa, 0, n);
        System.arraycopy(orig, n + 1, newa, n, len - n);
        return newa;
    }
```

4. 命令处理函数

```java

```



# 参考

【1】[谷歌dx工具源码](https://android.googlesource.com/platform/dalvik/+/26f9572/dx/src/com/android/dx/)