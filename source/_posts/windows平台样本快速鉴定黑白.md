---
title: windows平台样本快速鉴定黑白
date: 2019-11-28 17:37:48
tags: windows病毒分析
---

# 目标

* 快速批量鉴定样本

# 流程

## 第一步：VT过滤

通过VirusTotal检测完所有的的样本，将报毒数量大于10的样本直接判黑（这个数值可以浮动，具体看要求完成鉴定任务的时间以及样本数量）

## 第二步：下载过滤

对于未上传到VirusTotal的样本进行下载，如果下载失败，即找不到样本源，无需判定直接备注：找不到样本源

## 第三步：人工分析

### VT未不存在的样本

#### 情况1：样本可以外传

如果公司没有样本不能外传的要求，直接传VT，对于报毒量高的直接判黑

而对于样本报毒量低的走下面**"VT上存在的样本"**的分析流程

#### 情况2：样本不能外传

如果公司有内部沙箱，上传上去结合分析，可以省去一些动态分析步骤

针对不同文件的不同分析步骤：

##### 未加壳的EXE文件

2. **看签名**：如果存在正规公司的有效签名，直接判白
3. **看资源**：如果存在报毒量大的资源直接判黑
4. **看文件信息**：从文件版本信息中如果可以找到原始文件名、版本号、公司名称等信息，尝试下载对应正常文件的相近版本文件进行比较，满足以下两点基本可以判白
   * 导入函数、字符串表比对，相似度高并且样本中没有敏感字符
   * 如果入口点和区段不一样考虑是感染病毒的可能，可以看汇编代码判断
   * 动态运行结果相似、捕捉的动态行为相似、运行不起来，如果运行起来，同目录程序文件被修改则极为可能是感染病毒，直接判黑
5. **看PE文件信息**：导入函数、导出函数、字符串来找敏感数据，节头出现类似".rmnet"这种已经报出的感染特征的情况直接报毒
6. **动态运行（有沙箱的可以看沙箱省去手动运行步骤）**：看行为、关联文件、url等是否存在威胁，存在即判黑
7. 本地杀毒软件查杀：如果杀掉就判黑

##### 加过壳的EXE文件

1. 走一遍**未加壳的EXE文件**的检测流程
2. 动态运行抓行为，如果没有危险行为，就判白

##### PDF文件

1. **浏览器打开**
   * 伪加密PDF：点击里面可以访问的超链接然后VT搜索或者其他威胁情报平台查询URL链接的安全性，如果报毒直接判黑
   * 加密过的PDF：如果本地沙箱或者杀毒软件报毒直接判黑
2. **搜索JS代码**，检查是否存在漏洞利用的JS代码。使用**PDF Stream Dumper**，Search_For->JavaScript，看代码中是否存在0xc0这种类似的堆喷滑块代码，如果存在判黑

### VT上存在的样本

#### 未加壳的EXE文件

1. **看病毒名**
   - not-a-virus:Adware：判灰，广告相关
   - 其余步骤同上

#### 加过壳的EXE文件

1. 走一遍**未加壳的EXE文件**的检测流程
2. 动态运行抓行为，如果没有危险行为，就判白

#### PDF文件

1. **浏览器打开**
   - 伪加密PDF：点击里面可以访问的超链接然后VT搜索或者其他威胁情报平台查询URL链接的安全性，如果报毒直接判黑
   - 加密过的PDF：如果VT报毒直接判黑
2. **搜索JS代码**，检查是否存在漏洞利用的JS代码。使用**PDF Stream Dumper**，Search_For->JavaScript，看代码中是否存在0xc0这种类似的堆喷滑块代码，如果存在判黑

#### JS脚本

1. 如果VT存在多个报毒，直接判黑